// ObjectModel v4.0.0-alpha - http://objectmodel.js.org
// MIT License - Sylvain Pollet-Villard
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.window=e.window||{})}(this,function(e){"use strict";const t=Object.getPrototypeOf,r=Object.setPrototypeOf,n=(e,t)=>e.hasOwnProperty(t),i=(e,t)=>t instanceof e,o=e=>"function"==typeof e,s=e=>"object"==typeof e,l=e=>e&&s(e)&&t(e)===Object.prototype,a=e=>e&&o(e[Symbol.iterator]),u=(e,t)=>new Proxy(e,{apply:t}),f=(e,t,r)=>new Proxy(e,Object.assign({getPrototypeOf:()=>t.prototype},r)),c=(e,t={})=>{for(let r in t)if(l(t[r])){let n={};c(n,e[r]),c(n,t[r]),e[r]=n}else e[r]=t[r];return e},p=(e,t,r,n=!1)=>{Object.defineProperty(e,t,{value:r,enumerable:n,writable:!0,configurable:!0})},d=(e,t,n)=>{e.prototype=Object.assign(Object.create(t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n),r(e,t)},h=Symbol(),y=Symbol(),g=Symbol(),m=Symbol(),v=(e,t,n,i)=>(i&&d(e,i),((e,t)=>{r(e,t.prototype),p(e,"constructor",t)})(e,t),e.definition=n,e.assertions=[...e.assertions],p(e,"errors",[]),delete e.name,e),b=(e,t,r)=>(d(e,t,r),e.assertions.push(...t.assertions),e),$=(e,t,r,n,i)=>{e.push({expected:t,received:r,path:n,message:i})},j=(e,t=e.errorCollector)=>{let r=e.errors.length;if(r>0){let r=e.errors.map(e=>{if(!e.message){let t=[].concat(e.expected);e.message="expecting "+(e.path?e.path+" to be ":"")+t.map(e=>C(e)).join(" or ")+", got "+(null!=e.received?(e=>Object.prototype.toString.call(e).match(/\s([a-zA-Z]+)/)[1])(e.received)+" ":"")+C(e.received)}return e});e.errors.length=0,t.call(e,r)}return r},w=e=>e&&i(T,t(e).constructor),O=e=>{if(l(e))Object.keys(e).map(t=>{e[t]=O(e[t])});else{if(!Array.isArray(e))return[e];if(1===e.length)return[...e,void 0,null]}return e},S=(e,t)=>{let r=O(e).map(e=>C(e,t));return r.length>1?`(${r.join(" or ")})`:r[0]},P=(e,t=[])=>((t=[].concat(t)).length>0&&(e=t.reduce((e,t)=>e.concat(t),[].concat(e)).filter((e,t,r)=>r.indexOf(e)===t)),e),x=(e,t,r,n,o,s)=>{let a=o.indexOf(t);if(-1!==a&&-1!==o.indexOf(t,a+1))return e;if(i(T,t))s&&(e=D(e,t)),t[h](e,r,n,o.concat(t));else if(l(t))Object.keys(t).map(i=>{let l=e?e[i]:void 0;x(l,t[i],F(r,i),n,o,s)});else{if(O(t).some(t=>M(e,t,r,o)))return s&&(e=D(e,t)),e;$(n,t,e,r)}return e},M=(e,t,r,n,s)=>{if(null==e)return e===t;if(l(t)||i(T,t)){let i=[];return x(e,t,r,i,n,s),!i.length}return i(RegExp,t)?t.test(e):t===Number||t===Date?e.constructor===t&&!isNaN(e):e===t||o(t)&&i(t,e)||e.constructor===t},A=(e,t,r,n=t.errors)=>{for(let i of t.assertions){let s;try{s=i.call(t,e)}catch(e){s=e}if(!0!==s){let l=o(i.description)?i.description:(e,t)=>`assertion "${i.description}" returned ${C(e)} `+`for ${r?r+" =":"value"} ${C(t)}`;$(n,i,e,r,l.call(t,s,e,r))}}},C=(e,t=[])=>{if(t.length>15||t.includes(e))return"...";if(null==e)return String(e);if("string"==typeof e)return`"${e}"`;if(i(T,e))return e.toString(t);if(t.unshift(e),o(e))return e.name||e.toString();if(i(Map,e)||i(Set,e))return C([...e]);if(Array.isArray(e))return`[${e.map(e=>C(e,t)).join(", ")}]`;if(e.toString!==Object.prototype.toString)return e.toString();if(e&&s(e)){let r=Object.keys(e),n="\t".repeat(t.length);return`{${r.map(r=>`\n${n+r}: ${C(e[r],[...t])}`).join(",")} ${r.length?`\n${n.slice(1)}`:""}}`}return String(e)},F=(e,t)=>e?e+"."+t:t,k=(e,t,r,i,o,s,l)=>{let a=F(r,o),u=e.conventionForPrivate(o),f=e.conventionForConstant(o),c=n(i,o),p=c&&Object.getOwnPropertyDescriptor(i,o);o in t&&(u&&!s||f&&void 0!==i[o])&&R(`modify ${u?"private":"constant"} property ${o}`,e),l(a),n(t,o)&&x(i[o],t[o],a,e.errors,[]),A(i,e,a);let d=e.errors.length;return d&&(c?Object.defineProperty(i,o,p):delete i[o],j(e)),!d},R=(e,t)=>{t.errors.push({message:"cannot "+e})},D=(e,t=[])=>{if(!e||l(t)||i(N,t)||w(e))return e;let r=O(t),n=[];for(let t of r)i(T,t)&&!i(N,t)&&t.test(e)&&n.push(t);return 1===n.length?new n[0](e,m):(n.length>1&&console.warn(`Ambiguous model for value ${C(e)}, could be ${n.join(" or ")}`),e)},E=(e,r,i,s,a)=>{if(!l(i))return D(r,i);return new Proxy(r,{getPrototypeOf:()=>s?Object.prototype:t(r),get(t,r){if(r===g)return t;if("string"!=typeof r)return Reflect.get(t,r);let f=F(s,r),c=i[r];return!a&&r in i&&e.conventionForPrivate(r)?(R(`access to private property ${f}`,e),void j(e)):(t[r]&&n(t,r)&&!l(c)&&!w(t[r])&&(t[r]=D(t[r],c)),o(t[r])&&"constructor"!==r&&!a?(e=>u(e,(e,t,r)=>{a=!0;let n=Reflect.apply(e,t,r);return a=!1,n}))(t[r]):(l(c)&&!t[r]&&(t[r]={}),E(e,t[r],c,f,a)))},set:(t,r,n)=>k(e,i,s,t,r,a,o=>Reflect.set(t,r,E(e,n,i[r],o))),deleteProperty:(t,r)=>k(e,i,s,t,r,a,()=>Reflect.deleteProperty(t,r)),defineProperty:(t,r,n)=>k(e,i,s,t,r,a,()=>Reflect.defineProperty(t,r,n)),has:(t,r)=>Reflect.has(t,r)&&Reflect.has(i,r)&&!e.conventionForPrivate(r),ownKeys:t=>Reflect.ownKeys(t).filter(t=>Reflect.has(i,t)&&!e.conventionForPrivate(t)),getOwnPropertyDescriptor(t,r){let n;return e.conventionForPrivate(r)||void 0!==(n=Object.getOwnPropertyDescriptor(i,r))&&(n.value=t[r]),n}})};function T(e,t){return l(e)?new _(e,t):new N(e)}function N(e){let t=function(e=t.default){return t[y](e)?e:void 0};return v(t,N,e)}function _(e){let t=function(e,r){return i(t,this)?i(t,e)?e:(i(Object,e)||void 0===e||$(t.errors,Object,e),c(this,t.default),t.parentClass&&c(e,new t.parentClass(e)),c(this,e),r!==m&&t[y](this),E(t,this,t.definition)):new t(e)};return v(t,_,e,Object)}Object.assign(T.prototype,{name:"Model",assertions:[],conventionForConstant:e=>e.toUpperCase()===e,conventionForPrivate:e=>"_"===e[0],toString(e){return S(this.definition,e)},as(e){return p(this,"name",e),this},defaultTo(e){return this.default=e,this},[h](e,t,r,n){x(e,this.definition,t,r,n),A(e,this,t,r)},[y](e){return this[h](e,null,this.errors,[],!0),!j(this)},test(e,r){let i=this;for(;!n(i,"errorCollector");)i=t(i);let o,s=i.errorCollector;return i.errorCollector=(e=>{o=!0,r&&r.call(this,e)}),new this(e),i.errorCollector=s,!o},errorCollector(e){let t=new TypeError(e.map(e=>e.message).join("\n"));throw t.stack=t.stack.replace(/\n.*object-model(.|\n)*object-model.*/,""),t},assert(e,t=C(e)){return p(e,"description",t),this.assertions=this.assertions.concat(e),this}}),d(N,T,{extend(...e){let t=b(new N(P(this.definition,e)),this);for(let r of e)i(N,r)&&t.assertions.push(...r.assertions);return t}}),d(_,T,{defaultTo(e){let t=this.definition;for(let r in e)n(t,r)&&(e[r]=x(e[r],t[r],r,this.errors,[],!0));return j(this),this.default=e,this},toString(e){return C(this.definition,e)},extend(...e){let r={...this.definition},n={...this.prototype},l={...this.default},a=[];for(let t of e)i(T,t)&&(c(r,t.definition),c(l,t.default),a.push(...t.assertions)),o(t)&&c(n,t.prototype),s(t)&&c(r,t);let u=b(new _(r),this,n).defaultTo(l);return u.assertions=[...this.assertions,...a],t(this)!==_.prototype&&(u.parentClass=this),u},[h](e,t,r,n,i){if(s(e)){let o=this.definition;x(e[g]||e,o,t,r,n,i)}else $(r,this,e,t);A(e,this,t,r)}});const K=(e,t,r,i,s,l,a={})=>{let c=function(t=c.default,r){if(t=i(t),r===m||c[y](t))return f(t,c,Object.assign({get(t,r){if(r===g)return t;let i=t[r];return o(i)?u(i,(i,o,a)=>{if(n(l,r)){let[n,o=a.length-1,u]=l[r];for(let t=n;t<=o;t++){let n=u?u(t):c.definition;a[t]=x(a[t],n,`${e.name}.${r} arguments[${t}]`,c.errors,[],!0)}if(c.assertions.length>0){let e=s(t);i.apply(e,a),A(e,c,`after ${r} mutation`)}j(c)}return i.apply(t,a)}):i}},a))};return v(c,t,r,e)};function z(e){let t=K(Array,z,e,e=>Array.isArray(e)?e.map(e=>D(e,t.definition)):e,e=>[...e],{copyWithin:[],fill:[0,0],pop:[],push:[0],reverse:[],shift:[],sort:[],splice:[2],unshift:[0]},{set:(e,r,n)=>B(t,e,r,n,(e,t)=>e[r]=t,!0),deleteProperty:(e,r)=>B(t,e,r,void 0,e=>delete e[r])});return t}d(z,T,{toString(e){return"Array of "+S(this.definition,e)},[h](e,t,r,n){Array.isArray(e)?(e[g]||e).forEach((e,i)=>x(e,this.definition,`${t||"Array"}[${i}]`,r,n)):$(r,this,e,t),A(e,this,t,r)},extend(...e){return b(new z(P(this.definition,e)),this)}});let B=(e,t,r,n,i,o)=>{let s=`Array[${r}]`;+r>=0&&(o||r in t)&&(n=x(n,e.definition,s,e.errors,[],!0));let l=[...t];i(l),A(l,e,s);let a=!j(e);return a&&i(t,n),a};function U(...e){let t=function(e=t.default){if(t[y](e))return f(e,t,{get:(e,t)=>t===g?e:e[t],apply(e,r,n){let i,o=t.definition;return o.arguments.forEach((e,r)=>{n[r]=x(n[r],e,`arguments[${r}]`,t.errors,[],!0)}),A(n,t,"arguments"),t.errors.length||(i=Reflect.apply(e,r,n),"return"in o&&(i=x(i,o.return,"return value",t.errors,[],!0))),j(t),i}})};return v(t,U,{arguments:e},Function)}function W(e,t){let r=e=>0===e?n.definition.key:n.definition.value,n=K(Map,W,{key:e,value:t},e=>a(e)?new Map([...e].map(e=>e.map((e,t)=>D(e,r(t))))):e,e=>new Map(e),{set:[0,1,r],delete:[],clear:[]});return n}function Z(e){let t=K(Set,Z,e,e=>a(e)?new Set([...e].map(e=>D(e,t.definition))):e,e=>new Set(e),{add:[0,0],delete:[],clear:[]});return t}d(U,T,{toString(e=[]){let t=`Function(${this.definition.arguments.map(t=>S(t,[...e])).join(", ")})`;return"return"in this.definition&&(t+=" => "+S(this.definition.return,e)),t},return(e){return this.definition.return=e,this},extend(e,t){let r=this.definition.arguments,n=e.map((t,n)=>P(n in r?r[n]:[],e[n])),i=P(this.definition.return,t);return b(new U(...n).return(i),this)},[h](e,t,r){o(e)||$(r,"Function",e,t)}}),U.prototype.assert(function(e){return!(e.length>this.definition.arguments.length)||e},function(e){return`expecting ${this.definition.arguments.length} arguments for ${C(this)}, got ${e.length}`}),d(W,T,{toString(e){return`Map of ${S(this.definition.key,e)} : ${S(this.definition.value,e)}`},[h](e,t,r,n){if(i(Map,e)){t=t||"Map";for(let[i,o]of e)x(i,this.definition.key,`${t} key`,r,n),x(o,this.definition.value,`${t}[${C(i)}]`,r,n)}else $(r,this,e,t);A(e,this,t,r)},extend(e,t){return b(new W(P(this.definition.key,e),P(this.definition.value,t)),this)}}),d(Z,T,{toString(e){return"Set of "+S(this.definition,e)},[h](e,t,r,n){if(i(Set,e))for(let i of e.values())x(i,this.definition,`${t||"Set"} value`,r,n);else $(r,this,e,t);A(e,this,t,r)},extend(...e){return b(new Z(P(this.definition,e)),this)}}),e.Model=T,e.BasicModel=N,e.ObjectModel=_,e.ArrayModel=z,e.FunctionModel=U,e.MapModel=W,e.SetModel=Z,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=object-model.min.js.map
