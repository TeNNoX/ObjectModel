// ObjectModel v3.4.2 - http://objectmodel.js.org
// MIT License - Sylvain Pollet-Villard
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.window=e.window||{})}(this,function(e){"use strict";const t=e=>Object.getPrototypeOf(e),r=(e,t)=>e.hasOwnProperty(t),n=(e,t)=>t instanceof e,i=e=>"string"==typeof e,o=e=>"function"==typeof e,s=e=>"object"==typeof e,l=e=>Array.isArray(e),a=e=>e&&s(e)&&t(e)===Object.prototype,u=(e,t)=>new Proxy(e,t),f=(e,t)=>u(e,{apply:t}),c=(e,t,r)=>u(e,Object.assign({getPrototypeOf:()=>t.prototype},r)),d=(e,t)=>Object.keys(e).map(t),p=(e,t={},r)=>{for(let n in t)if(r&&a(t[n])){let i={};p(i,e[n],r),p(i,t[n],r),e[n]=i}else e[n]=t[n]},h=(e,t,r,n=!1)=>{Object.defineProperty(e,t,{value:r,enumerable:n,writable:!0,configurable:!0})},y=(e,t)=>{Object.setPrototypeOf(e,t.prototype),h(e,"constructor",t)},g=(e,t,r)=>{e.prototype=Object.assign(Object.create(t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r),Object.setPrototypeOf(e,t)},v=(e,t=[])=>{if(t.length>15||t.includes(e))return"...";if(null===e||void 0===e)return String(e);if(i(e))return`"${e}"`;if(n(N,e))return e.toString(t);if(t.unshift(e),o(e))return e.name||e.toString();if(n(Map,e)||n(Set,e))return v([...e]);if(l(e))return`[${e.map(e=>v(e,t)).join(", ")}]`;if(e.toString!==Object.prototype.toString)return e.toString();if(e&&s(e)){let r=Object.keys(e),n="\t".repeat(t.length);return`{${r.map(r=>`\n${n+r}: ${v(e[r],t.slice())}`).join(",")} ${r.length?`\n${n.slice(1)}`:""}}`}return String(e)},m=(e,t)=>e?e+"."+t:t,b=Symbol(),O=e=>{if(a(e))d(e,t=>{e[t]=O(e[t])});else{if(!l(e))return[e];if(1===e.length)return[...e,void 0,null]}return e},j=(e,t)=>O(e).map(e=>v(e,t)).join(" or "),w=(e,t=[])=>(l(t)||(t=[t]),t.length>0&&(e=t.reduce((e,t)=>e.concat(t),l(e)?e.slice():[e]).filter((e,t,r)=>r.indexOf(e)===t)),e),$=(e,t,r,i,o)=>{let s=o.indexOf(t);if(-1!==s&&-1!==o.indexOf(t,s+1))return e;if(e=x(e,t),n(N,t))t[b](e,r,i,o.concat(t));else if(a(t))d(t,n=>{$(e?e[n]:void 0,t[n],m(r,n),i,o)});else{if(O(t).some(t=>P(e,t,r,o)))return e;T(i,t,e,r)}return e},P=(e,t,r,i)=>{if(null==e)return e===t;if(a(t)||n(N,t)){let n=[];return $(e,t,r,n,i),!n.length}return n(RegExp,t)?t.test(e):t===Number||t===Date?e.constructor===t&&!isNaN(e):e===t||o(t)&&n(t,e)||e.constructor===t},S=(e,t,r,n=t.errors)=>{for(let i of t.assertions){let s;try{s=i.call(t,e)}catch(e){s=e}if(!0!==s){let l=o(i.description)?i.description:(e,t)=>`assertion "${i.description}" returned ${v(e)} `+`for ${r?r+" =":"value"} ${v(t)}`;T(n,i,e,r,l.call(t,s,e,r))}}},x=(e,t=[])=>{if(!e||a(t)||B(e))return e;let r=O(t),i=[];for(let t of r)n(N,t)&&t.test(e)&&i.push(t);return 1===i.length?i[0](e):(i.length>1&&console.warn(`Ambiguous model for value ${v(e)}, could be ${i.join(" or ")}`),e)};function M(e){let t=function(e=t.default){return t.validate(e)?e:void 0};return y(t,M),_(t,e),t}g(M,N,{extend(...e){let t=K(new M(w(this.definition,e)),this);for(let r of e)n(M,r)&&t.assertions.push(...r.assertions);return t}});const F=Symbol();function k(e,t){let r=function(e=r.default){return n(r,this)?n(r,e)?e:(p(this,r[F](e),!0),r.validate(this)?A(r,this,r.definition):void 0):new r(e)};return Object.assign(r,t),g(r,Object),y(r,k),_(r,e),r}g(k,N,{sealed:!1,defaults(e){return Object.assign(this.prototype,e),this},toString(e){return v(this.definition,e)},extend(...e){let r=this,i=Object.assign({},this.definition),l=[],a={};p(a,r.prototype,!1);for(let t of e)n(N,t)&&(p(i,t.definition,!0),l.push(...t.assertions)),o(t)&&p(a,t.prototype,!0),s(t)&&p(i,t,!0);let u=K(new k(i),r,a);return u.assertions=r.assertions.concat(l),t(r)!==k.prototype&&(u[F]=(e=>{let t=new r(e);return p(e,t,!0),e})),u},[F]:e=>e,[b](e,t,r,n){if(s(e)){let i=this.definition;$(e,i,t,r,n),this.sealed&&E(e,i,r)}else T(r,this,e,t);S(e,this,t,r)}});let R=(e,t)=>{t.errors.push({message:"cannot "+e})},A=(e,n,s,l)=>a(s)?u(n,{getPrototypeOf:()=>l?Object.prototype:t(n),get(t,n){if(!i(n))return Reflect.get(t,n);let u=m(l,n),f=s[n];return n in s&&e.conventionForPrivate(n)?(R(`access to private property ${u}`,e),void z(e)):(t[n]&&r(t,n)&&!a(f)&&!B(t[n])&&(t[n]=x(t[n],f)),o(t[n])&&t[n].bind?t[n].bind(t):(a(f)&&!t[n]&&(t[n]={}),A(e,t[n],f,u)))},set:(t,r,n)=>C(e,s,l,t,r,i=>Reflect.set(t,r,A(e,n,s[r],i))),deleteProperty:(t,r)=>C(e,s,l,t,r,()=>Reflect.deleteProperty(t,r)),defineProperty:(t,r,n)=>C(e,s,l,t,r,()=>Reflect.defineProperty(t,r,n)),has:(t,r)=>Reflect.has(t,r)&&Reflect.has(s,r)&&!e.conventionForPrivate(r),ownKeys:t=>Reflect.ownKeys(t).filter(t=>Reflect.has(s,t)&&!e.conventionForPrivate(t)),getOwnPropertyDescriptor(t,r){let n;return e.conventionForPrivate(r)||void 0!==(n=Object.getOwnPropertyDescriptor(s,r))&&(n.value=t[r]),n}}):x(n,s),C=(e,t,n,i,o,s)=>{let l=m(n,o),a=e.conventionForPrivate(o),u=e.conventionForConstant(o),f=r(i,o),c=f&&Object.getOwnPropertyDescriptor(i,o);o in t&&(a||u&&void 0!==i[o])&&R(`modify ${a?"private":"constant"} ${o}`,e);let d=r(t,o);d||!e.sealed?(s(l),d&&$(i[o],t[o],l,e.errors,[]),S(i,e,l)):D(l,i[o],e.errors);let p=e.errors.length;return p&&(f?Object.defineProperty(i,o,c):delete i[o],z(e)),!p},E=(e,t,n,i)=>{d(e,o=>{let s=e[o],l=m(i,o);r(t,o)?a(s)&&E(s,t[o],n,l):D(l,s,n)})},D=(e,t,r)=>{r.push({path:e,received:t,message:`property ${e} is not declared in the sealed model definition`})};function N(e,t){return a(e)?new k(e,t):new M(e)}Object.assign(N.prototype,{name:"Model",assertions:[],conventionForConstant:e=>e.toUpperCase()===e,conventionForPrivate:e=>"_"===e[0],toString(e){return j(this.definition,e)},as(e){return h(this,"name",e),this},defaultTo(e){return this.default=e,this},[b](e,t,r,n){$(e,this.definition,t,r,n),S(e,this,t,r)},validate(e,t){return this[b](e,null,this.errors,[]),!z(this,t)},test(e){let t,r=this.errorCollector;return this.errorCollector=(()=>{t=!0}),new this(e),this.errorCollector=r,!t},errorCollector(e){let t=new TypeError(e.map(e=>e.message).join("\n"));throw t.stack=t.stack.replace(/\n.*object-model(.|\n)*object-model.*/,""),t},assert(e,t=v(e)){return h(e,"description",t),this.assertions=this.assertions.concat(e),this}});let _=(e,t)=>{e.definition=t,e.assertions=[...e.assertions],h(e,"errors",[]),delete e.name},K=(e,t,r)=>(g(e,t,r),e.assertions.push(...t.assertions),e),T=(e,t,r,n,i)=>{e.push({expected:t,received:r,path:n,message:i})},z=(e,t=e.errorCollector)=>{let r=e.errors.length;if(r>0){let r=e.errors.map(e=>{if(!e.message){let t=l(e.expected)?e.expected:[e.expected];e.message="expecting "+(e.path?e.path+" to be ":"")+t.map(e=>v(e)).join(" or ")+", got "+(null!=e.received?(e=>Object.prototype.toString.call(e).match(/\s([a-zA-Z]+)/)[1])(e.received)+" ":"")+v(e.received)}return e});e.errors=[],t.call(e,r)}return r},B=e=>e&&n(N,t(e).constructor),I=["pop","push","reverse","shift","sort","splice","unshift"];function U(e){let t=function(e=t.default){if(t.validate(e))return c(e,t,{get(r,n){let i=r[n];return o(i)?f(i,(i,o,s)=>{if(I.includes(n)){let e=r.slice();i.apply(e,s),t.validate(e)}let l=i.apply(r,s);return e.forEach((e,n)=>r[n]=x(e,t.definition)),l}):i},set:(e,r,n)=>Z(e,r,n,t),deleteProperty:(e,r)=>!(r in e)||Z(e,r,void 0,t)})};return g(t,Array),y(t,U),_(t,e),t}g(U,N,{toString(e){return"Array of "+j(this.definition,e)},[b](e,t,r,n){l(e)?e.forEach((i,o)=>{e[o]=$(i,this.definition,`${t||"Array"}[${o}]`,r,n)}):T(r,this,e,t),S(e,this,t,r)},extend(...e){return K(new U(w(this.definition,e)),this)}});let Z=(e,t,r,n)=>{let i=`Array[${t}]`;parseInt(t)===+t&&t>=0&&(r=$(r,n.definition,i,n.errors,[]));let o=e.slice();o[t]=r,S(o,n,i);let s=!z(n);return s&&(e[t]=r),s};function q(...e){let t=function(e=t.default){if(t.validate(e))return c(e,t,{apply(e,r,n){let i,o=t.definition;return o.arguments.forEach((e,r)=>{n[r]=$(n[r],e,`arguments[${r}]`,t.errors,[])}),S(n,t,"arguments"),t.errors.length||(i=Reflect.apply(e,r,n),"return"in o&&(i=$(i,o.return,"return value",t.errors,[]))),z(t),i}})};return g(t,Function),y(t,q),_(t,{arguments:e}),t}g(q,N,{toString(e=[]){let t=`Function(${this.definition.arguments.map(t=>j(t,e.slice())).join(",")})`;return"return"in this.definition&&(t+=" => "+j(this.definition.return,e)),t},return(e){return this.definition.return=e,this},extend(e,t){let r=this.definition.arguments,n=e.map((t,n)=>w(n in r?r[n]:[],e[n])),i=w(this.definition.return,t);return K(new q(...n).return(i),this)},[b](e,t,r){o(e)||T(r,"Function",e,t)}}),q.prototype.assert(function(e){return!(e.length>this.definition.arguments.length)||e},function(e){return`expecting ${this.definition.arguments.length} arguments for ${v(this)}, got ${e.length}`});let G=["set","delete","clear"];function H(e,t){let r=function(e=r.default){let t=e=>["key","value"].map((t,n)=>x(e[n],r.definition[t])),n=new Map([...e].map(t));if(r.validate(n))return c(n,r,{get(e,n){let i=e[n];return o(i)?f(i,(i,o,s)=>{if("set"===n&&(s=t(s)),G.includes(n)){let t=new Map(e);i.apply(t,s),r.validate(t)}return i.apply(e,s)}):i}})};return g(r,Map),y(r,H),_(r,{key:e,value:t}),r}g(H,N,{toString(e){let{key:t,value:r}=this.definition;return`Map of ${j(t,e)} : ${j(r,e)}`},[b](e,t,r,n){if(e instanceof Map){t=t||"Map";for(let[i,o]of e)$(i,this.definition.key,`${t} key`,r,n),$(o,this.definition.value,`${t}[${v(i)}]`,r,n)}else T(r,this,e,t);S(e,this,t,r)},extend(e,t){let{key:r,value:n}=this.definition;return K(new H(w(r,e),w(n,t)),this)}});let J=["add","delete","clear"];function L(e){let t=function(e=t.default){let r=e=>x(e,t.definition),n=new Set([...e].map(r));if(t.validate(n))return c(n,t,{get(e,n){let i=e[n];return o(i)?f(i,(i,o,s)=>{if("add"===n&&(s[0]=r(s[0])),J.includes(n)){let r=new Set(e);i.apply(r,s),t.validate(r)}return i.apply(e,s)}):i}})};return g(t,Set),y(t,L),_(t,e),t}g(L,N,{toString(e){return"Set of "+j(this.definition,e)},[b](e,t,r,n){if(e instanceof Set)for(let i of e.values())$(i,this.definition,`${t||"Set"} value`,r,n);else T(r,this,e,t);S(e,this,t,r)},extend(...e){return K(new L(w(this.definition,e)),this)}}),e.Model=N,e.BasicModel=M,e.ObjectModel=k,e.ArrayModel=U,e.FunctionModel=q,e.MapModel=H,e.SetModel=L,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=object-model.min.js.map
