// ObjectModel v4.0.0-alpha - http://objectmodel.js.org
// MIT License - Sylvain Pollet-Villard
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).window=e.window||{})}(this,function(e){"use strict";const t=Object.getPrototypeOf,r=Object.setPrototypeOf,n=(e,t)=>e.hasOwnProperty(t),i=(e,t)=>t instanceof e,o=e=>"function"==typeof e,s=e=>e&&"object"==typeof e,l=e=>s(e)&&t(e)===Object.prototype,a=e=>e&&o(e[Symbol.iterator]),f=(e,t)=>new Proxy(e,t),u=(e,t={})=>{for(let r in t)if(l(t[r])){let n={};u(n,e[r]),u(n,t[r]),e[r]=n}else e[r]=t[r];return e},c=(e,t,r,n=!1)=>{Object.defineProperty(e,t,{value:r,enumerable:n,writable:!0,configurable:!0})},p=(e,t,n)=>{e.prototype=Object.assign(Object.create(t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n),r(e,t)},d=Symbol(),h=Symbol(),g=Symbol(),y=(e,t,n,o,s,l)=>{let a=function(e=a.default,t){return l&&!i(a,this)?new a(e):(o&&(e=o(e,a,this)),t===h||P(a,e)?s?f(e,s(a)):e:void 0)};return n&&p(a,n),r(a,t.prototype),a.constructor=t,a.definition=e,a.assertions=[...a.assertions],c(a,"errors",[]),delete a.name,a},m=(e,t,r)=>i(t,e)?e:(s(e)||o(e)||void 0===e||b(t.errors,Object,e),u(r,t.default),t.parentClass&&u(e,new t.parentClass(e)),u(r,e),r),v=(e,t,r)=>(p(e,t,r),e.assertions.push(...t.assertions),e),b=(e,t,r,n,i)=>{e.push({expected:t,received:r,path:n,message:i})},O=(e,t=e.errorCollector)=>{let r=e.errors.length;if(r>0){let r=e.errors.map(e=>{if(!e.message){let t=[].concat(e.expected);e.message="expecting "+(e.path?e.path+" to be ":"")+t.map(e=>C(e)).join(" or ")+", got "+(null!=e.received?(e=>Object.prototype.toString.call(e).match(/\s([a-zA-Z]+)/)[1])(e.received)+" ":"")+C(e.received)}return e});e.errors.length=0,t.call(e,r)}return r},$=e=>e&&t(e)&&i(N,t(e).constructor),j=e=>{if(l(e))Object.keys(e).map(t=>{e[t]=j(e[t])});else{if(!Array.isArray(e))return[e];if(1===e.length)return[...e,void 0,null]}return e},w=(e,t)=>{let r=j(e).map(e=>C(e,t));return r.length>1?`(${r.join(" or ")})`:r[0]},S=(e,t=[])=>((t=[].concat(t)).length>0&&(e=t.reduce((e,t)=>e.concat(t),[].concat(e)).filter((e,t,r)=>r.indexOf(e)===t)),e),P=(e,t)=>(e[d](t,null,e.errors,[],!0),!O(e)),x=(e,t,r,n,o,s)=>{let a=o.indexOf(t);if(-1!==a&&-1!==o.indexOf(t,a+1))return e;if(i(N,t))s&&(e=D(e,t)),t[d](e,r,n,o.concat(t));else if(l(t))Object.keys(t).map(i=>{let l=e?e[i]:void 0;x(l,t[i],F(r,i),n,o,s)});else{if(j(t).some(t=>M(e,t,r,o)))return s?D(e,t):e;b(n,t,e,r)}return e},M=(e,t,r,n,s)=>{if(t===z)return!0;if(null==e)return e===t;if(l(t)||i(N,t)){let i=[];return x(e,t,r,i,n,s),!i.length}return i(RegExp,t)?t.test(e):t===Number||t===Date?e.constructor===t&&!isNaN(e):e===t||o(t)&&i(t,e)||e.constructor===t},A=(e,t,r,n=t.errors)=>{for(let i of t.assertions){let s;try{s=i.call(t,e)}catch(e){s=e}if(!0!==s){let l=o(i.description)?i.description:(e,t)=>`assertion "${i.description}" returned ${C(e)} `+`for ${r?r+" =":"value"} ${C(t)}`;b(n,i,e,r,l.call(t,s,e,r))}}},C=(e,t=[])=>{if(t.length>15||t.includes(e))return"...";if(null==e)return String(e);if("string"==typeof e)return`"${e}"`;if(i(N,e))return e.toString(t);if(t.unshift(e),o(e))return e.name||e.toString();if(i(Map,e)||i(Set,e))return C([...e]);if(Array.isArray(e))return`[${e.map(e=>C(e,t)).join(", ")}]`;if(e.toString!==Object.prototype.toString)return e.toString();if(s(e)){let r=Object.keys(e),n="\t".repeat(t.length);return`{${r.map(r=>`\n${n+r}: ${C(e[r],[...t])}`).join(",")} ${r.length?`\n${n.slice(1)}`:""}}`}return String(e)},F=(e,t)=>e?e+"."+t:t,k=(e,t,r,i,o,s,l)=>{let a=F(r,o),f=e.conventionForPrivate(o),u=e.conventionForConstant(o),c=n(i,o),p=c&&Object.getOwnPropertyDescriptor(i,o);o in t&&(f&&!s||u&&void 0!==i[o])&&R(`modify ${f?"private":"constant"} property ${o}`,e),l(a),n(t,o)&&x(i[o],t[o],a,e.errors,[]),A(i,e,a);let d=e.errors.length;return d&&(c?Object.defineProperty(i,o,p):delete i[o],O(e)),!d},R=(e,t)=>{t.errors.push({message:"cannot "+e})},D=(e,t=[])=>{if(!e||l(t)||i(_,t)||$(e))return e;let r=j(t),n=[];for(let t of r)i(N,t)&&!i(_,t)&&t.test(e)&&n.push(t);return 1===n.length?new n[0](e,h):(n.length>1&&console.warn(`Ambiguous model for value ${C(e)}, could be ${n.join(" or ")}`),e)},T=(e,t,r,n,i)=>l(r)?f(e,E(t,r,n,i)):D(e,r),E=(e,r,i,s)=>{return{getPrototypeOf:e=>i?Object.prototype:t(e),get(t,a){if(a===g)return t;if("string"!=typeof a)return Reflect.get(t,a);let u=F(i,a),c=r[a];return!s&&a in r&&e.conventionForPrivate(a)?(R(`access to private property ${u}`,e),void O(e)):(t[a]&&n(t,a)&&!l(c)&&!$(t[a])&&(t[a]=D(t[a],c)),o(t[a])&&"constructor"!==a&&!s?(e=>f(e,{apply(e,t,r){s=!0;let n=Reflect.apply(e,t,r);return s=!1,n}}))(t[a]):(l(c)&&!t[a]&&(t[a]={}),T(t[a],e,c,u,s)))},set:(t,n,o)=>k(e,r,i,t,n,s,i=>Reflect.set(t,n,T(o,e,r[n],i))),deleteProperty:(t,n)=>k(e,r,i,t,n,s,()=>Reflect.deleteProperty(t,n)),defineProperty:(t,n,o)=>k(e,r,i,t,n,s,()=>Reflect.defineProperty(t,n,o)),has:(t,n)=>Reflect.has(t,n)&&Reflect.has(r,n)&&!e.conventionForPrivate(n),ownKeys:t=>Reflect.ownKeys(t).filter(t=>Reflect.has(r,t)&&!e.conventionForPrivate(t)),getOwnPropertyDescriptor(t,n){let i;return e.conventionForPrivate(n)||void 0!==(i=Object.getOwnPropertyDescriptor(r,n))&&(i.value=t[n]),i}}};function N(e,t){return l(e)?new K(e,t):new _(e)}function _(e){return y(e,_)}function K(e){return y(e,K,Object,m,t=>E(t,e),!0)}Object.assign(N.prototype,{name:"Model",assertions:[],conventionForConstant:e=>e.toUpperCase()===e,conventionForPrivate:e=>"_"===e[0],toString(e){return w(this.definition,e)},as(e){return c(this,"name",e),this},defaultTo(e){return this.default=e,this},[d](e,t,r,n){x(e,this.definition,t,r,n),A(e,this,t,r)},test(e,r){let i=this;for(;!n(i,"errorCollector");)i=t(i);let o,s=i.errorCollector;return i.errorCollector=(e=>{o=!0,r&&r.call(this,e)}),new this(e),i.errorCollector=s,!o},errorCollector(e){let t=new TypeError(e.map(e=>e.message).join("\n"));throw t.stack=t.stack.replace(/\n.*object-model(.|\n)*object-model.*/,""),t},assert(e,t=C(e)){return c(e,"description",t),this.assertions=this.assertions.concat(e),this}}),p(_,N,{extend(...e){let t=v(new _(S(this.definition,e)),this);for(let r of e)i(_,r)&&t.assertions.push(...r.assertions);return t}}),p(K,N,{defaultTo(e){let t=this.definition;for(let r in e)n(t,r)&&(e[r]=x(e[r],t[r],r,this.errors,[],!0));return O(this),this.default=e,this},toString(e){return C(this.definition,e)},extend(...e){let r={...this.definition},n={...this.prototype},l={...this.default},a=[];for(let t of e)i(N,t)&&(u(r,t.definition),u(l,t.default),a.push(...t.assertions)),o(t)&&u(n,t.prototype),s(t)&&u(r,t);let f=v(new K(r),this,n).defaultTo(l);return f.assertions=[...this.assertions,...a],t(this)!==K.prototype&&(f.parentClass=this),f},[d](e,t,r,n,i){if(s(e)){let o=this.definition;x(e[g]||e,o,t,r,n,i)}else b(r,this,e,t);A(e,this,t,r)}});const z=f(_(),{apply:(e,t,[r])=>Object.assign(Object.create(z),{definition:r})});z.definition=z,z.toString=(()=>"Any"),z.remaining=function(e){this.definition=e},p(z.remaining,z,{toString(){return"..."+w(this.definition)}}),z[Symbol.iterator]=function*(){yield new z.remaining(this.definition)};const B=(e,t,r,i,s,l,a)=>y(r,t,e,i,t=>Object.assign({getPrototypeOf:()=>t.prototype,get(r,i){if(i===g)return r;let a=r[i];return o(a)?f(a,{apply(o,a,f){if(n(l,i)){let[n,a=f.length-1,u]=l[i];for(let r=n;r<=a;r++){let n=u?u(r):t.definition;f[r]=x(f[r],n,`${e.name}.${i} arguments[${r}]`,t.errors,[],!0)}if(t.assertions.length>0){let e=s(r);o.apply(e,f),A(e,t,`after ${i} mutation`)}O(t)}return o.apply(r,f)}}):a}},a));function U(e){let t=B(Array,U,e,e=>Array.isArray(e)?e.map(e=>D(e,t.definition)):e,e=>[...e],{copyWithin:[],fill:[0,0],pop:[],push:[0],reverse:[],shift:[],sort:[],splice:[2],unshift:[0]},{set:(e,r,n)=>W(t,e,r,n,(e,t)=>e[r]=t,!0),deleteProperty:(e,r)=>W(t,e,r,void 0,e=>delete e[r])});return t}p(U,N,{toString(e){return"Array of "+w(this.definition,e)},[d](e,t,r,n){Array.isArray(e)?(e[g]||e).forEach((e,i)=>x(e,this.definition,`${t||"Array"}[${i}]`,r,n)):b(r,this,e,t),A(e,this,t,r)},extend(...e){return v(new U(S(this.definition,e)),this)}});let W=(e,t,r,n,i,o)=>{let s=`Array[${r}]`;+r>=0&&(o||r in t)&&(n=x(n,e.definition,s,e.errors,[],!0));let l=[...t];i(l),A(l,e,s);let a=!O(e);return a&&i(t,n),a};function Z(...e){return y({arguments:e},Z,Function,null,e=>({getPrototypeOf:()=>e.prototype,get:(e,t)=>t===g?e:e[t],apply(t,r,n){let o,s=e.definition,l=s.arguments.find(e=>i(z.remaining,e)),a=l?Math.max(n.length,s.arguments.length-1):s.arguments.length;for(let t=0;t<a;t++){let r=l&&t>=s.arguments.length-1?l.definition:s.arguments[t];n[t]=x(n[t],r,`arguments[${t}]`,e.errors,[],!0)}return A(n,e,"arguments"),e.errors.length||(o=Reflect.apply(t,r,n),"return"in s&&(o=x(o,s.return,"return value",e.errors,[],!0))),O(e),o}}))}function q(e,t){let r=e=>0===e?n.definition.key:n.definition.value,n=B(Map,q,{key:e,value:t},e=>a(e)?new Map([...e].map(e=>e.map((e,t)=>D(e,r(t))))):e,e=>new Map(e),{set:[0,1,r],delete:[],clear:[]});return n}function G(e){let t=B(Set,G,e,e=>a(e)?new Set([...e].map(e=>D(e,t.definition))):e,e=>new Set(e),{add:[0,0],delete:[],clear:[]});return t}p(Z,N,{toString(e=[]){let t=`Function(${this.definition.arguments.map(t=>w(t,[...e])).join(", ")})`;return"return"in this.definition&&(t+=" => "+w(this.definition.return,e)),t},return(e){return this.definition.return=e,this},extend(e,t){let r=this.definition.arguments,n=e.map((t,n)=>S(n in r?r[n]:[],e[n])),i=S(this.definition.return,t);return v(new Z(...n).return(i),this)},[d](e,t,r){o(e)||b(r,"Function",e,t)}}),Z.prototype.assert(function(e){let t=this.definition.arguments;return!(e.length>t.length&&!t.some(e=>i(z.remaining,e)))||e},function(e){return`expecting ${this.definition.arguments.length} arguments for ${C(this)}, got ${e.length}`}),p(q,N,{toString(e){return`Map of ${w(this.definition.key,e)} : ${w(this.definition.value,e)}`},[d](e,t,r,n){if(i(Map,e)){t=t||"Map";for(let[i,o]of e)x(i,this.definition.key,`${t} key`,r,n),x(o,this.definition.value,`${t}[${C(i)}]`,r,n)}else b(r,this,e,t);A(e,this,t,r)},extend(e,t){return v(new q(S(this.definition.key,e),S(this.definition.value,t)),this)}}),p(G,N,{toString(e){return"Set of "+w(this.definition,e)},[d](e,t,r,n){if(i(Set,e))for(let i of e.values())x(i,this.definition,`${t||"Set"} value`,r,n);else b(r,this,e,t);A(e,this,t,r)},extend(...e){return v(new G(S(this.definition,e)),this)}}),e.Model=N,e.BasicModel=_,e.ObjectModel=K,e.ArrayModel=U,e.FunctionModel=Z,e.MapModel=q,e.SetModel=G,e.Any=z,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=object-model.min.js.map
